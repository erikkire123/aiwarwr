<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benji</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  
  <style>
      /* Modern Dark Gradient Background */
body {
    font-family: 'Arial', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #1a1a1a 0%, #872316 50%, #1a1a1a 100%);
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Glassmorphism Container */
.container {
    max-width: 800px;
    width: 90%;
    background: rgba(0, 0, 0, 0.4); /* Semi-transparent dark background */
    backdrop-filter: blur(15px); /* Blur effect */
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Heading Styling */
h1 {
    font-size: 2.5rem;
    margin-bottom: 20px;
    text-align: center;
    color: #fff;
    text-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

/* Textarea Styling */
textarea {
    width: 100%;
    height: 150px;
    margin-bottom: 20px;
    padding: 15px;
    font-family: 'Courier New', monospace;
    font-size: 14px;
    background: rgba(255, 255, 255, 0.1); /* Semi-transparent white */
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: #fff;
    resize: none;
    transition: border-color 0.3s, box-shadow 0.3s;
}

textarea::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

textarea:focus {
    border-color: #ff4757; /* Crimson border on focus */
    box-shadow: 0 0 10px rgba(255, 71, 87, 0.5); /* Crimson glow */
    outline: none;
}

/* Button Styling */
button {
    padding: 12px 24px;
    background: linear-gradient(135deg, #ff4757 0%, #e84118 100%); /* Crimson gradient */
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1rem;
    margin-right: 10px;
    transition: transform 0.2s, box-shadow 0.2s;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4); /* Crimson shadow */
}

button:active {
    transform: translateY(0);
}

/* IP List Styling */
#ipList {
    margin-top: 20px;
    font-family: 'Courier New', monospace;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.1); /* Semi-transparent white */
    padding: 15px;
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
}

/* Map Styling */
#map {
    margin-top: 20px;
    height: 400px;
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
    h1 {
        font-size: 2rem;
    }

    .container {
        padding: 20px;
    }

    button {
        width: 100%;
        margin-bottom: 10px;
    }
}
    </style>

</head>
<body>
    <div class="container">
        <h1>IP List and Map</h1>
        <textarea id="jsonInput" placeholder="Paste your JSON here"></textarea>
        <button onclick="processJSON()">Process JSON</button>
        <button onclick="fetchAndClear()">Clear and Fetch from Database</button>
        <div id="ipList"></div>
        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let map;

        function processJSON() {
            const jsonInput = document.getElementById('jsonInput').value;
            try {
                const data = JSON.parse(jsonInput);
                const ips = data.userList.map(item => item.userInfo).filter(ip => ip);
                const uniqueIPs = [...new Set(ips)]; // Remove duplicate IPs
                displayIPs(uniqueIPs);
                displayMap(uniqueIPs);
            } catch (e) {
                alert('Invalid JSON');
            }
        }

        function displayIPs(ips) {
            const ipList = document.getElementById('ipList');
            ipList.innerHTML = '<h2>IP List</h2>' + ips.join('<br>');
        }

        async function fetchIPDetails(ip) {
            try {
                // Use ipinfo.io directly
                const response = await fetch(`https://ipinfo.io/${ip}/json?token=4c0f8c262fc07c`);
                if (!response.ok) throw new Error('Failed to fetch IP details');
                const data = await response.json();
                if (data.loc) {
                    const [latitude, longitude] = data.loc.split(',');
                    return { latitude, longitude, city: data.city, region: data.region, country_name: data.country };
                }
                return null;
            } catch (error) {
                console.error(`Error fetching details for IP ${ip}:`, error);
                return null;
            }
        }

        async function displayMap(ips) {
            // Initialize the map if it doesn't exist
            if (!map) {
                map = L.map('map').setView([0, 0], 2);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(map);
            } else {
                // Clear existing markers
                map.eachLayer(layer => {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });
            }

            for (let i = 0; i < ips.length; i++) {
                const ip = ips[i];
                const data = await fetchIPDetails(ip);

                if (data && data.latitude && data.longitude) {
                    const marker = L.marker([data.latitude, data.longitude]).addTo(map);
                    marker.bindPopup(`<b>IP:</b> ${ip}<br><b>Location:</b> ${data.city}, ${data.region}, ${data.country_name}`);
                }

                // Add a delay to avoid hitting rate limits (e.g., 2 seconds delay between requests)
                await new Promise(resolve => setTimeout(resolve, 1));
            }
        }

        async function fetchAndClear() {
            const jsonInput = document.getElementById('jsonInput');
            jsonInput.value = ''; // Clear the textbox

            try {
                // Fetch JSON data from jsonbin.io
                const binId = '679bd7efad19ca34f8f71ef2';
                const apiKey = '$2a$10$O/cOnsqjkNbGqZOlFuRi6.xkoflpYxs.mR/r/nH70SMAe3eXZhA.K';
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
                    headers: {
                        'X-Master-Key': apiKey,
                    },
                });

                if (!response.ok) throw new Error('Failed to fetch data from JSONBin');

                const data = await response.json();
                jsonInput.value = JSON.stringify(data.record, null, 2); // Pretty-print JSON
            } catch (error) {
                console.error('Error fetching JSON from database:', error);
                alert('Failed to fetch JSON from database');
            }
        }
    </script>
</body>
</html>
